---
layout: base
title: Form
---
<form class="needs-validation mt-5 mb-5" id="formTest" method="post" action="#" novalidate>
  <div class="container">
    <div class="row">
      <div class="col-lg-4">
        <div class="form-group">
          <label for="nome">Nome</label>
          <input type="text" class="form-control" id="nome" required>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="form-group">
          <label for="validationAge">Et√†</label>
          <input type="number" class="form-control" id="validationAge" value="18" min="18" max="20" step="1" required>
        </div>
      </div>
    </div>
    <div class="row">
      <button class="btn btn-primary mt-3" type="submit">Invia</button>
    </div>
  </div>
</form>

<script>
  // Fetch all the forms we want to apply custom Bootstrap validation styles to
  var forms = document.querySelectorAll('.needs-validation')
  var formFeedback = '<div class="feedback" aria-describedby="nome"></div>'
  //string to html
  var stringToHTML = function (str) {
    var parser = new DOMParser();
    var doc = parser.parseFromString(str, 'text/html');
    return doc.body.firstChild;
  };
  //single input check
  function checkInput( form ){
    var inputs = form.querySelectorAll("input,select,textarea,fieldset");
    Array.from(inputs).forEach(el => {
      removeAlert( el )
      createAlert( el )
    })
  }

  //check error type
  function checkErrorType(el,formFeedback,messages,message){
    var presentMessage = el.nextElementSibling;
    if (!el.nextElementSibling){
      el.after(formFeedback)
    }else{
      if ( presentMessage.innerHTML !== message) {
        presentMessage.insertAdjacentHTML( 'beforeend', message );
      }
    }
  }
  //message alert remove
  function removeAlert( el ){

  }

  //message alert creation
  function createAlert( el ){
    var id = el.getAttribute('id');
    var formFeedback = stringToHTML('<div class="feedback" aria-describedby="'+id+'"></div>')
    var toRemove
    var messages = {
      mandatory : '<span class="mandatory">Campo obbligatorio</span>',
      underflow : '<span class="underflow">Valore inferiore al minimo consentito</span>',
      overflow : '<span class="overflow">Valore superiore al massimo consentito</span>'
    }
    var message
    if( el.validity.valueMissing ) {
      message = messages.mandatory
      checkErrorType(el,formFeedback,messages,message)
    }else{
      var element = document.getElementById(id);
      if (element.nextElementSibling){
        toRemove = element.nextElementSibling.querySelector('.mandatory')
        if (toRemove){
          toRemove.remove()
        }
      }
    }
    if( el.validity.rangeUnderflow ) {
      message = messages.underflow
      checkErrorType(el,formFeedback,messages,message)
    }else{
      var element = document.getElementById(id);
      if (element.nextElementSibling){
        toRemove = element.nextElementSibling.querySelector('.underflow')
        if (toRemove){
          toRemove.remove()
        }
      }
    }
    if( el.validity.rangeOverflow ) {
      message = messages.overflow
      checkErrorType(el,formFeedback,messages,message)
    }else{
      var element = document.getElementById(id);
      if (element.nextElementSibling){
        toRemove = element.nextElementSibling.querySelector('.overflow')
        if (toRemove){
          toRemove.remove()
        }
      }
    }

    formFeedback.insertAdjacentHTML( 'beforeend', message );
  }
  // Loop over them and prevent submission
  Array.prototype.slice.call(forms)
    .forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
          checkInput(form)
        }
        form.classList.add('was-validated')
      }, false)
    })
</script>
